rabbitmq:
    image: tutum/rabbitmq
    environment:
        - RABBITMQ_PASS=wZ59kFTJZN8YQ
    ports: 
        - "4369:4369"
        - "5672:5672"
        - "15672:15672"

postgres:
    restart: always
    image: postgres:latest
    volumes_from:
        - data
    ports:
        - "5432:5432"

redis:
    image: redis

data:
  restart: no
  image: postgres:latest
  volumes:
    - /var/lib/postgresql
  command: /bin/true

celery:
    build: ./dss.api
    volumes_from:
        - api
    links:
        - "postgres:postgres"
        - "redis:redis"
        - "rabbitmq:rabbitmq"
    command: ./run_celery.sh
    #command: python manage.py celeryd

api:
    build: ./dss.api
    volumes:
        - /files
    ports:
        - "8000:8000"
    links:
        - "postgres:postgres"
        - "redis:redis"
        - "rabbitmq:rabbitmq"
    command: ./run_web.sh

web:
    restart: always
    build: ./dss.web
    links:
        - "redis:redis"
    ports:
        - "8080:8080"

nginx:
    restart: always
    build: ./nginx/
    ports:
        - "80:80"
        - "443:443"
    links:
        - "api:api"
        - "web:web"
    volumes_from:
        - api
